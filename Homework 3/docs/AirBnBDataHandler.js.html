<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: AirBnBDataHandler.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: AirBnBDataHandler.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { readFile, writeFile } from "node:fs/promises";
import * as d3 from "d3";

export const AirBnBDataHandler = {
  listings: [],

  /**
   * Load CSV file and parse into JSON
   * @param {string} filePath - Path to the CSV file
   * @returns {Promise&lt;AirBnBDataHandler>} - Returns itself for chaining
   */
  async load(filePath) {
    const data = await readFile(filePath, "utf-8");
    this.listings = d3.csvParse(data).map((listing) => ({
      ...listing, // keep all original fields
      price: parseFloat(listing.price.replace(/[$,]/g, "")) || 0,
      bedrooms: parseInt(listing.bedrooms) || 0,
      review_score: parseFloat(listing.review_scores_rating) || 0,
      host_id: listing.host_id,
    }));
    return this;
  },

  /**
   * Filter listings based on price, number of rooms, or review score
   * @param {Object} filters - Object containing filter criteria
   * @param {number} [filters.minPrice]
   * @param {number} [filters.maxPrice]
   * @param {number} [filters.minRooms]
   * @param {number} [filters.maxRooms]
   * @param {number} [filters.minScore]
   * @param {number} [filters.maxScore]
   * @returns {AirBnBDataHandler} - Returns itself for chaining
   */
  filter(filters) {
    this.listings = this.listings.filter(
      (listing) =>
        (!filters.minPrice || listing.price >= filters.minPrice) &amp;&amp;
        (!filters.maxPrice || listing.price &lt;= filters.maxPrice) &amp;&amp;
        (!filters.minRooms || listing.bedrooms >= filters.minRooms) &amp;&amp;
        (!filters.maxRooms || listing.bedrooms &lt;= filters.maxRooms) &amp;&amp;
        (!filters.minScore || listing.review_score >= filters.minScore) &amp;&amp;
        (!filters.maxScore || listing.review_score &lt;= filters.maxScore)
    );
    return this;
  },

  /**
   * Compute statistics on filtered listings
   * @returns {Object} Statistics object
   */
  computeStats() {
    const count = this.listings.length;
    const avgPricePerRoom =
      this.listings.reduce(
        (acc, listing) => acc + listing.price / (listing.bedrooms || 1),
        0
      ) / count || 0;
    return { count, avgPricePerRoom };
  },

  /**
   * Compute host listing rankings
   * @returns {Array} Sorted array of hosts by number of listings
   */
  computeHostRankings() {
    const hostCounts = this.listings.reduce((acc, { host_id }) => {
      acc[host_id] = (acc[host_id] || 0) + 1;
      return acc;
    }, {});
    return Object.entries(hostCounts).sort((a, b) => b[1] - a[1]);
  },

  /**
   * Export results to a file
   * @param {string} filePath - Output file path
   * @returns {Promise&lt;void>}
   */
  async exportResults(filePath) {
    const data = JSON.stringify(
      {
        filteredListings: this.listings,
        stats: this.computeStats(),
        hostRankings: this.computeHostRankings(),
      },
      null, //include all fields
      2 //indent with 2
    );
    await writeFile(filePath, data);
  },
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a>
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
